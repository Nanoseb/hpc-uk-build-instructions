Performance Results for NEMO 4.2.0 (CCE15) on ARCHER2 from 2023-07-07
=====================================================================

The performance results were generated by running the [NEMO GYRE_PISCES benchmark](https://sites.nemo-ocean.io/user-guide/cfgs.html#gyre-pisces).

NEMO was run in detached mode with XIOS (trunk r2528) as a separate executable.
The benchmark jobs requested two nodes with 2 XIOS servers and 48 ocean processes
per node. The XIOS servers each ran within their own NUMA region and the ocean
processes were distributed over the remaining six NUMA regions such that there was
a free CPU between each process.

Various NEMO parameters were set in the `namelist_cfg` file, see the table below.

Parameter | Description                        | Value 
--------- | ---------------------------------- | ----- 
nn_it000  | first time step                    | 1 
nn_itend  | last time step                     | 43200
nn_stock  | frequency of restart file creation | -1
nn_GYRE   | GYRE resolution (degree)           | 1
rn_Dt     | time step size in seconds          | 7200
jpni      | grid extend in x direction         | 8
jpnj      | grid extend in y direction         | 12

Both NEMO and XIOS were built using CCE 15, see [build_nemo_4.2.0_archer2_cce15.md](build_nemo_4.2.0_archer2_cce15.md).


The runtime and energy results were obtain via the `sacct` command.

```bash
sacct -j <job id> --format=JobID,JobName%20,NNodes,ReqCPUFreq,Elapsed,ConsumedEnergyRaw
```

The actual numbers were taken from the `myscript_wrapper.sh` task indicated in the `sacct` output.


### Runtime (s)

Comms | Turbo   | Cnt | Min | Max | Avg
----- | -----   | --- | --- | --- | ---
OFI   | &cross; |   3 | 352 | 385 | 368
OFI   | &check; |   3 | 282 | 317 | 299
UCX   | &cross; |   3 | 346 | 413 | 381
UCX   | &check; |   3 | 357 | 411 | 384


### Energy [J]

Comms | Turbo   | Cnt |     Min |     Max |     Avg
----- | -----   | --- | ------- | ------- | -------
OFI   | &cross; |   3 | 189,301 | 194,964 | 192,190
OFI   | &check; |   3 | 218,387 | 238,674 | 225,454
UCX   | &cross; |   3 | 185,834 | 227,725 | 211,940
UCX   | &check; |   3 | 267,294 | 313,267 | 290,870


We can see that `OFI` beats `UCX` whether or not turbo mode (`srun --cpu-freq=2250000 ...`) is on or off.
This is possibly due to the fact that the benchmark is being run on just two nodes.

In any case, for the `OFI` results, the turbo boost performance ratio is (368/299) $\div$ (225454/192190) = 1.049. 
